<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="manifest" href="/rando-matos/manifest.json">
    <title>Backpack Filler Prototype Avancé</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <link rel="stylesheet" href="style.css">
</head>
<body>

    <div class="main-content">
        <div id="inventory-section" class="content-section active">
             <select id="view-filter" class="mb-4 p-2 border rounded">
                 <option value="all">Voir tout</option>
                 <option value="categories">Voir par Catégorie</option>
                 </select>
            <ul id="item-list" class="item-list">
                </ul>
            <div id="total-weight" class="total-weight">
                Poids Total : 0 g
            </div>
        </div>

        <div id="new-item-section" class="content-section">
            <div class="form-grid">
                <div class="form-group">
                    <label for="item-name">Nom de l'item</label>
                    <input type="text" id="item-name" placeholder="Ex: Tente 2 places">
                </div>
                <div class="form-group">
                     <label for="item-weight">Poids (g)</label>
                    <input type="number" id="item-weight" placeholder="Ex: 1500" min="0">
                </div>
                <div class="form-group">
                    <label for="item-brand">Marque</label>
                    <input type="text" id="item-brand" placeholder="Ex: Decathlon">
                </div>
                <div class="form-group">
                    <label for="item-category">Catégorie</label>
                    <select id="item-category"> <option value="">-- Sélectionner une Catégorie --</option>
                    </select>
                </div>
                <div class="form-group">
                    <label for="item-tags">Tags (séparés par virgule)</label>
                    <input type="text" id="item-tags" placeholder="Ex: bivouac, léger">
                </div>
                <div class="form-group">
                    <label for="item-capacity">Capacité/Volume</label>
                    <input type="text" id="item-capacity" placeholder="Ex: 2 personnes / 15L">
                </div>
                <div class="form-group">
                    <label for="item-image-url">URL Image (optionnel)</label>
                    <input type="url" id="item-image-url" placeholder="Ex: https://example.com/tente.jpg">
                    <img id="new-item-image-preview" class="image-preview" src="https://placehold.co/80x80/eeeeee/aaaaaa?text=Image" alt="Aperçu image" style="display: none;">
                </div>
                 <div class="checkbox-group">
                     <input type="checkbox" id="item-consumable">
                     <label for="item-consumable">Consommable</label>
                 </div>
            </div>
            <button id="suggest-new-item-details-button" class="llm-button">Suggérer Détails Item ✨</button>
            <button id="add-item-button" class="form-button">Ajouter Item</button>
            <span id="new-item-loading-indicator" class="llm-loading-indicator hidden">Chargement...</span>
        </div>

         <div id="manage-packs-section" class="content-section">
            <div class="input-group"> <input type="text" id="pack-name" placeholder="Nom du nouveau Pack">
                <button id="add-pack-button">Créer Pack</button>
            </div>
            <h3>Liste des Packs</h3>
            <ul id="pack-list" class="pack-list">
                </ul>
         </div>

         <div id="pack-detail-section" class="content-section">
             <button id="unpack-all-button" class="unpack-all-button">Tout Déballer ce Pack</button> <div class="pack-detail-grid">
                 <div class="pack-detail-column">
                     <h3>Items dans ce Pack</h3>
                     <ul id="items-in-pack-list">
                         </ul>
                 </div>
                 <div class="pack-detail-column">
                     <h3>Items disponibles</h3>
                     <ul id="available-items-list">
                         </ul>
                 </div>
             </div>
         </div>

         <div id="manage-categories-section" class="content-section">
             <div class="input-group"> <input type="text" id="category-name" placeholder="Nom de la nouvelle Catégorie">
                 <button id="add-category-button">Créer Catégorie</button>
             </div>
             <p class="text-gray-600 mb-4">Cliquez sur une catégorie pour voir les items associés.</p>
             <ul id="category-management-list" class="category-management-list">
                 </ul>
         </div>

         <div id="generate-pack-section" class="content-section">
             <div class="form-grid">
                 <div class="form-group">
                     <label for="gen-pack-destination">Destination (lieu ou type de terrain)</label>
                     <input type="text" id="gen-pack-destination" placeholder="Ex: Montagnes, Forêt, Ville">
                 </div>
                 <div class="form-group">
                     <label for="gen-pack-duration">Durée (en jours)</label>
                     <input type="number" id="gen-pack-duration" min="1" value="3">
                 </div>
                 <div class="form-group">
                     <label for="gen-pack-activity">Activité principale</label>
                     <input type="text" id="gen-pack-activity" placeholder="Ex: Randonnée, Camping, Ski, Voyage">
                 </div>
             </div>
             <button id="generate-pack-list-button" class="llm-button">Générer Suggestions ✨</button>
             <span id="generate-pack-loading-indicator" class="llm-loading-indicator hidden">Génération en cours...</span>

             <div id="generated-pack-results" class="mt-8"> <!-- Removed hidden class -->
                 <h3>Suggestions d'Items</h3>
                 <ul id="generated-items-list" class="item-list">
                     <!-- Generated items will be inserted here -->
                     <li class="text-center text-gray-500">Aucune suggestion d'item générée. Veuillez utiliser le formulaire ci-dessus.</li>
                 </ul>
                 <button id="add-selected-generated-items-button" class="form-button mt-4">Ajouter les items sélectionnés à l'inventaire</button>
             </div>
         </div>


         <div id="pack-packing-modal" class="hidden fixed inset-0 bg-gray-600 bg-opacity-50 overflow-y-auto h-full w-full z-50">
             <div class="relative top-20 mx-auto p-5 border w-96 shadow-lg rounded-md bg-white">
                 <div class="mt-3 text-center">
                     <h3 class="text-lg leading-6 font-medium text-gray-900" id="packing-pack-name">Emballage du Pack : </h3>
                     <div class="mt-2 px-7 py-3">
                         <ul id="pack-packing-list">
                             </ul>
                     </div>
                     <div class="items-center px-4 py-3">
                         <button id="close-packing-modal" class="px-4 py-2 bg-blue-500 text-white text-base font-medium rounded-md w-full shadow-sm hover:bg-blue-700 focus:outline-none focus:ring-2 focus::ring-blue-500">
                             Fermer
                         </button>
                     </div>
                 </div>
             </div>
         </div>

         <div id="edit-item-modal" class="modal">
             <div class="modal-content">
                 <span class="close-button" id="close-edit-modal">&times;</span>
                 <h2>Modifier Item</h2>
                  <div class="form-grid">
                     <div class="form-group">
                         <label for="edit-item-name">Nom de l'item</label>
                         <input type="text" id="edit-item-name">
                     </div>
                     <div class="form-group">
                          <label for="edit-item-weight">Poids (g)</label>
                         <input type="number" id="edit-item-weight" min="0">
                     </div>
                     <div class="form-group">
                         <label for="edit-item-brand">Marque</label>
                         <input type="text" id="edit-item-brand">
                     </div>
                     <div class="form-group">
                         <label for="edit-item-category">Catégorie</label>
                         <select id="edit-item-category"> <option value="">-- Sélectionner une Catégorie --</option>
                         </select>
                     </div>
                     <div class="form-group">
                         <label for="edit-item-tags">Tags (séparés par virgule)</label>
                         <input type="text" id="edit-item-tags">
                     </div>
                     <div class="form-group">
                         <label for="edit-item-capacity">Capacité/Volume</label>
                         <input type="text" id="edit-item-capacity">
                     </div>
                     <div class="form-group">
                         <label for="edit-item-image-url">URL Image (optionnel)</label>
                         <input type="url" id="edit-item-image-url">
                         <img id="edit-item-image-preview" class="image-preview" src="https://placehold.co/80x80/eeeeee/aaaaaa?text=Image" alt="Aperçu image" style="display: none;">
                     </div>
                      <div class="checkbox-group">
                          <input type="checkbox" id="edit-item-consumable">
                          <label for="edit-item-consumable">Consommable</label>
                      </div>
                 </div>
                 <button id="suggest-edit-item-details-button" class="llm-button">Suggérer Détails Item ✨</button>
                 <button id="save-item-button" class="form-button">Enregistrer les modifications</button>
                 <span id="edit-item-loading-indicator" class="llm-loading-indicator hidden">Chargement...</span>
                 <input type="hidden" id="editing-item-id">
             </div>
         </div>


    </div>

    <div class="sidebar">
        <h2>Backpack Filler</h2>
        <nav>
            <ul>
                <li><a href="#inventory" class="active" data-section="inventory"><i class="fas fa-boxes"></i> Stock <span id="inventory-weight" class="menu-weight"></span></a></li>
                <li><a href="#new-item" data-section="new-item"><i class="fas fa-plus-circle"></i> Ajouter un Item</a></li>
                <li><a href="#manage-packs" data-section="manage-packs"><i class="fas fa-suitcase"></i> Packs</a></li>
                 <li><a href="#manage-categories" data-section="manage-categories"><i class="fas fa-tags"></i> Catégories</a></li>
                 <li><a href="#generate-pack-section" data-section="generate-pack"><i class="fas fa-magic"></i> Générer un Pack ✨</a></li>
            </ul>
        </nav>
         </div>

    <script src="app.js"></script>
    <script>
      if ('serviceWorker' in navigator) {
        window.addEventListener('load', () => {
          navigator.serviceWorker.register('/rando-matos/sw.js', { scope: '/rando-matos/' })
            .then(registration => {
              console.log('ServiceWorker registration successful with scope: ', registration.scope);
            })
            .catch(error => {
              console.log('ServiceWorker registration failed: ', error);
            });
        });
      }
    </script>

</body>
</html>
